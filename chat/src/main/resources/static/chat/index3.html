<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>微信</title>
    <link rel="stylesheet" type="text/css" href="../css/base.css">
    <link rel="stylesheet" type="text/css" href="../css/chat.css">
</head>
<script src="../js/jquery-3.4.1.min.js"></script>
<script src="../layer/layer.js"></script>
<script src="../js/util.js"></script>
<style>


</style>
<body style="overflow-y: hidden">
    <div id="indexDiv" style="width:100%;height: 100%">
        <!-- 头部 -->
        <div style="width:100%;height: 5%;background-color: #EDEDED">
            <div style="vertical-align:middle;height: 100%;width:88%;float: left">
                <h2 id="title" style="display:block;position: relative;top:50%;transform:translateY(-50%);left:52%;width: 20%;">消息</h2>
            </div>
            <div style="width:8%;height:100%;float:right;margin-right: 3%;">
                <img id="topAdd" class="btnIcon" src="../img/jia.png" height="100%" width="100%">
            </div>
        </div>
        <!-- 消息 -->
        <div id="chatListDiv" class="listDiv scrollDiv" style="overflow-y:scroll;overflow-x: hidden;width:100%;height: 87%;">
            <div class="container" style="width:100%;height: 6%;background-color: #EDEDED">
                <form action="" class="parent" style="width:100%;height: 100%;">
                    <input id="chatLiInput" type="text" class="search" placeholder="" >
                    <input type="button" name="" id="cleanChatSearchBtn" class="searchCleanBtn">
                    <input type="button" name="" id="chatSearchBtn" class="searchBtn">
                </form>
            </div>
            <div id="msgListDiv">
                <ul id="chatUl" class="chatUl">
                    <li id="0001" type="single">
                        <div class="liContentDiv scrollDiv">
                            <div class="liContentImgDiv">
                                <img src="../img/head.png">
                                <div class="notice">13</div>
                            </div>
                            <div class="liContentRightDiv">
                                <div class="liContentUser">用户A</div>
                                <div class="liContentRecord">现在几点了</div>
                            </div>
                        </div>
                        <div class="liSpace"/>
                    </li>
                    <li id="0002"  type="single">
                        <div class="liContentDiv scrollDiv">
                            <div class="liContentImgDiv">
                                <img src="../img/head.png">
                                <div class="notice">13</div>
                            </div>
                            <div class="liContentRightDiv">
                                <div class="liContentUser">用户B</div>
                                <div class="liContentRecord">现在几点了</div>
                            </div>
                        </div>
                        <div class="liSpace"/>
                    </li>
                </ul>
            </div>
        </div>
        <!-- 好友 friendDiv-->
        <div id="friendDiv" class="listDiv scrollDiv" style="overflow-y:scroll;overflow-x: hidden;width:100%;height: 87%;">
            <div class="container" style="width:100%;height: 6%;background-color: #EDEDED">
                <form action="" class="parent" style="width:100%;height: 100%;">
                    <input id="friendUlInput" type="text" class="search" placeholder="" >
                    <input type="button" name="" id="cleanFriendSearchBtn" class="searchCleanBtn">
                    <input type="button" name="" id="friendSearchBtn" class="searchBtn">
                </form>
            </div>

            <div style="width:97%;height:4%;margin:1%;border-bottom: 1px solid #F8F8F8;">
                <div id="singleTab" class="friendTab checkedFriendTab" style="">联系人</div>
                <div id="groupTab" class="friendTab" style="">群组</div>
            </div>

            <div id="friendListDiv" style="margin-top: 1%;">
                <ul id="friendUl" class="chatUl friendUl">
                    <li>
                        <div class="liContentDiv scrollDiv">
                            <div class="liContentImgDiv">
                                <img src="../img/head.png">
                            </div>
                            <div class="liContentRightDiv">
                                <div class="liFriendUser">用户A</div>
                            </div>
                        </div>
                        <div class="liSpace"/>
                    </li>
                    <li>
                        <div class="liContentDiv scrollDiv">
                            <div class="liContentImgDiv">
                                <img src="../img/head.png">
                            </div>
                            <div class="liContentRightDiv">
                                <div class="liFriendUser">用户B</div>
                            </div>
                        </div>
                        <div class="liSpace"/>
                    </li>
                </ul>
                <ul id="groupUl" class="chatUl friendUl" style="display: none">
                    <li>
                        <div class="liContentDiv scrollDiv">
                            <div class="liContentImgDiv">
                                <img src="../img/grouphead.png">
                            </div>
                            <div class="liContentRightDiv">
                                <div class="liFriendUser">群组G</div>
                            </div>
                        </div>
                        <div class="liSpace"/>
                    </li>
                    <li>
                        <div class="liContentDiv scrollDiv">
                            <div class="liContentImgDiv">
                                <img src="../img/grouphead.png">
                            </div>
                            <div class="liContentRightDiv">
                                <div class="liFriendUser">群组Q</div>
                            </div>
                        </div>
                        <div class="liSpace"/>
                    </li>
                </ul>
            </div>
        </div>
        <!-- 底部 -->
        <div style="width:100%;height: 8%;position: fixed;bottom: 0;background-color: #EDEDED">
            <div style="height: 100%;width: 50%;float: left;text-align: center;">
                <img src="../img/chatgreen.png" class="btnIcon" id="chatIcon" height="80%" width="25%" style="margin-top: 5px">
            </div>
            <div style="height: 100%;width: 50%;float: left;text-align: center;">
                <img src="../img/friend.png" class="btnIcon" id="friendIcon" height="80%" width="25%" style="margin-top: 5px">
            </div>

        </div>
    </div>
    <div id="chatDiv" style="width:100%;height: 100%;display: none">
        <!-- 头部 -->
        <div style="width:100%;height: 5%;background-color: #EDEDED">
            <div style="width:8%;height:100%;float:left;margin-right: 3%;">
                <img id="topOutIcon" class="btnIcon" src="../img/back.png" height="100%" width="100%">
                <img id="topBackIcon" class="btnIcon" src="../img/back.png" height="100%" width="100%">
            </div>
            <div style="vertical-align:middle;height: 100%;width:64%;float: left">
                <h2 id="titleName" style="display:block;position: relative;top:50%;transform:translateY(-50%);left:52%;width: 20%;">用户A</h2>
                <h2 id="titleChatDetail" style="display:block;position: relative;top:50%;transform:translateY(-50%);left:52%;width: 20%;display: none">对话详情</h2>
            </div>
            <div style="width:8%;height:100%;float:right;margin-right: 3%;">
                <img id="topPointIcon" class="btnIcon" src="../img/point.png" height="100%" width="100%">
            </div>
        </div>

        <!-- 聊天详情 -->
        <div id="chatDetailDiv" style="width:100%;height: 95%;display: none">
            <div style="width:100%;overflow: hidden">
                <div class="chatPersonDiv">
                    <img src="../img/head.png" >
                    用户A
                </div>
                <div class="chatPersonDiv">
                    <img src="../img/head.png" >
                    用户B
                </div>
                <div class="chatPersonDiv">
                    <img src="../img/head.png" >
                    用户C
                </div>
                <div class="chatPersonDiv">
                    <img src="../img/head.png" >
                    用户D
                </div>
                <div class="chatPersonDiv">
                    <img src="../img/head.png" >
                    用户E
                </div>
                <div id="chatPersonAddIcon" class="btnIcon chatPersonDiv">
                    <img src="../img/jia.png" >
                </div>
            </div>
            <div id="groupDetail" style="width:100%;padding:3%;display:none">
                <span>群聊名称</span>
                <input type="text" placeholder="xx讨论群" style="margin-left: 3%;">
                <input type="button" class="btnIcon" value="确认修改" style="float: right;margin-right: 6%;width: 16%;">
            </div>
        </div>
        <!--中部-->
        <div id="chatMainDiv" style="width:100%;height: 95%;">
            <!-- 聊天记录 -->
            <div id="chatWindow" class="scrollDiv" style="overflow-y:scroll;width:100%;height: 80%;background-color: #F6F6F6">
                <div class="leftTalk">
                    <div class="leftTalkImgDiv talkImgDiv">
                        <img src="../img/head.png">
                    </div>
                    <div class="leftTalkContent">
                        <div class="talkUser">用户A</div>
                        <div class="talkBubble">今天星期几</div>
                    </div>
                </div>
                <div class="leftTalk">
                    <div class="leftTalkImgDiv talkImgDiv">
                        <img src="../img/head.png">
                    </div>
                    <div class="leftTalkContent">
                        <div class="talkUser">用户A</div>
                        <div class="talkBubble">今天星期几</div>
                    </div>
                </div>
                <div class="leftTalk">
                    <div class="leftTalkImgDiv talkImgDiv">
                        <img src="../img/head.png">
                    </div>
                    <div class="leftTalkContent">
                        <div class="talkUser">用户A</div>
                        <div class="talkBubble">今天星期几</div>
                    </div>
                </div><div class="leftTalk">
                <div class="leftTalkImgDiv talkImgDiv">
                    <img src="../img/head.png">
                </div>
                <div class="leftTalkContent">
                    <div class="talkUser">用户A</div>
                    <div class="talkBubble">今天星期几</div>
                </div>
            </div>
                <div class="leftTalk">
                    <div class="leftTalkImgDiv talkImgDiv">
                        <img src="../img/head.png">
                    </div>
                    <div class="leftTalkContent">
                        <div class="talkUser">用户A</div>
                        <div class="talkBubble">今天星期几</div>
                    </div>
                </div>
                <div class="leftTalk">
                    <div class="leftTalkImgDiv talkImgDiv">
                        <img src="../img/head.png">
                    </div>
                    <div class="leftTalkContent">
                        <div class="talkUser">用户A</div>
                        <div class="talkBubble">今天星期几</div>
                    </div>
                </div>
                <div class="leftTalk">
                    <div class="leftTalkImgDiv talkImgDiv">
                        <img src="../img/head.png">
                    </div>
                    <div class="leftTalkContent">
                        <div class="talkUser">用户A</div>
                        <div class="talkBubble">今天星期几</div>
                    </div>
                </div>
                <div class="leftTalk">
                    <div class="leftTalkImgDiv talkImgDiv">
                        <img src="../img/head.png">
                    </div>
                    <div class="leftTalkContent">
                        <div class="talkUser">用户A</div>
                        <div class="talkBubble">今天星期几</div>
                    </div>
                </div>
                <div class="RightTalk">
                    <div class="rightTalkImgDiv talkImgDiv">
                        <img src="../img/head.png">
                    </div>
                    <div class="rightTalkContent">
                        <div class="talkUser">我</div>
                        <div class="rightTalkBubble">不知道</div>
                    </div>
                </div>
            </div>
            <!-- 底部 -->
            <div style="width:100%;height: 20%;">
                <textarea id="talkInput" class="scrollDiv" style="width: 93%;height: 55%;margin: 3%;"></textarea>
                <input type="button" id="talksub" value="发送" style="width: 15%;height: 20%;float: right;margin-right: 3%;">
            </div>
        </div>
    </div>
</body>
<script>
    var userId="";

    $(function(){
        userId=GetUrlParam("id");
        openSocket();
    });

    function openSocket() {
        if(typeof(WebSocket) == "undefined") {
            console.log("您的浏览器不支持WebSocket");
        }else{
            // console.log("您的浏览器支持WebSocket");
            var socketUrl="http://localhost:8080/ws/"+userId;
            socketUrl=socketUrl.replace("https","ws").replace("http","ws");
            socket = new WebSocket(socketUrl);
            //打开事件
            socket.onopen = function() {
                console.log(userId+" : 首页websocket已打开");
            };
            //获得消息事件
            socket.onmessage = function(msg) {
                console.log("index页面 ： "+msg.data);
            };
            //关闭事件
            socket.onclose = function() {
                console.log("websocket已关闭");
            };
            //发生了错误事件
            socket.onerror = function() {
                console.log("websocket发生了错误");
            }
        }
    }


    /*好友列表搜索框*/
    $("#friendSearchBtn").on("click",function(){
        var searchName=$("#friendUlInput").val();
        if(searchName==""||searchName==null||searchName=="undefined"){
            console.log("输入框为空");
            return;
        }
        $("#cleanFriendSearchBtn").show();
        $(".friendUl li").each(function(i,n){
            $(this).show();
            var name=$(this.getElementsByClassName("liFriendUser")[0]).text();
            if(name.indexOf(searchName)==-1){
                $(this).hide();
            }
        })
    })
    $("#cleanFriendSearchBtn").on("click",function(){
        $("#friendUlInput").val("");
        $(".friendUl li").show();
        $(this).hide();
    })
    /*消息列表搜索框*/
    $("#chatSearchBtn").on("click",function(){
        var searchName=$("#chatLiInput").val();
        if(searchName==""||searchName==null||searchName=="undefined"){
            console.log("输入框为空");
            return;
        }
        $("#cleanChatSearchBtn").show();
        $("#chatUl li").each(function(i,n){
            $(this).show();
            var name=$(this.getElementsByClassName("liContentUser")[0]).text();
            if(name.indexOf(searchName)==-1){
                $(this).hide();
            }
        })
    })
    $("#cleanChatSearchBtn").on("click",function(){
        $("#chatLiInput").val("");
        $("#chatUl li").show();
        $(this).hide();
    })

    //右上按钮-弹出创建群页面
    $("#topAdd").on("click",function(){
        var index = layer.open({
            title: false,
            type: 2,
            anim: 0,//动画0-6
            content: 'http://localhost:8080/chat/addGroup.html',
            area: ['100%', '100%'],
            // maxmin: true,
            closeBtn:0
        });
        layer.full(index);
    })

    //切换显示个人和群组
    $("#singleTab").on("click",function(){
        $(".friendTab").removeClass("checkedFriendTab");
        $("#singleTab").addClass("checkedFriendTab");
        $("#groupUl").hide();
        $("#friendUl").show();
    })
    $("#groupTab").on("click",function(){
        $(".friendTab").removeClass("checkedFriendTab");
        $("#groupTab").addClass("checkedFriendTab");
        $("#friendUl").hide();
        $("#groupUl").show();
    })

    //跳转聊天页面
    $(".chatUl li").on("click",function(){
        var id=this.getAttribute("id");
        var type=this.getAttribute("type");
        console.log(id+"  "+type);
        // alert("跳转聊天");
        $("#indexDiv").hide();
        $("#chatDiv").show();
        // var index = layer.open({
        //     title: false,
        //     type: 2,
        //     anim: 3,//动画0-6
        //     content: 'http://localhost:8080/chat/chat.html?src='+userId+'&dst='+id+'&type='+type,
        //     area: ['100%', '100%'],
        //     // maxmin: true,
        //     closeBtn:0
        // });
        // layer.full(index);
        //消除未读提醒
        $(this.getElementsByClassName("notice")).hide();
    })

    //底部按钮
    $("#friendIcon").on("click",function(){
        //切换图标
        this.src="../img/friendgreen.png";
        $("#chatIcon").attr("src","../img/chat.png");
        //显示好友列表
        $("#chatListDiv").hide();
        $("#friendDiv").show();
        $("#title").text("好友");
    })
    $("#chatIcon").on("click",function(){
        //切换图标
        this.src="../img/chatgreen.png";
        $("#friendIcon").attr("src","../img/friend.png");
        //显示好友列表
        $("#friendDiv").hide();
        $("#chatListDiv").show();
        $("#title").text("消息");
    })

</script>
</html>